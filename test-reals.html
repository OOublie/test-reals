<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤ä¹ æçº²åˆ·é¢˜å™¨</title>
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- å¼•å…¥ Babel ç”¨äºè§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ js-yaml -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <!-- å¼•å…¥ Lucide å›¾æ ‡ -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* Tailwind é…ç½® */
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    boxShadow: {
                        'ios': '0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03)',
                        'ios-hover': '0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -2px rgba(0, 0, 0, 0.04)',
                        'glow': '0 0 15px rgba(0, 122, 255, 0.3)'
                    }
                }
            }
        };

        /* å…¨å±€æ ·å¼ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
            /* ç¡®ä¿é¡µé¢é«˜åº¦ä¸ºè§†å£é«˜åº¦ï¼Œä¸”ä¸èƒ½æ»šåŠ¨ */
            height: 100vh;
            overflow: hidden;
            background-color: #F2F2F7;
        }
        .dark body {
            background-color: #000000;
        }

        /* TikTok æ»šåŠ¨å®¹å™¨ */
        .snap-scroll-y {
            height: 100vh;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            -webkit-overflow-scrolling: touch; /* å¯ç”¨ iOS å¼¹æ€§æ»šåŠ¨ */
        }

        /* æ¯ä¸ªé¢˜ç›®å¡ç‰‡å æ®å®Œæ•´è§†å£ */
        .snap-item {
            scroll-snap-align: start;
            min-height: 100vh; /* ç¡®ä¿å æ®æ•´ä¸ªè§†å£ */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* ç£¨ç ‚ç»ç’ƒæ•ˆæœ */
        .backdrop-blur-md {
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        /* éšè—æ»šåŠ¨æ¡ */
        .snap-scroll-y::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="antialiased selection:bg-blue-500 selection:text-white transition-colors duration-300">
    <div id="root" class="h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- å›¾æ ‡ç»„ä»¶å°è£… ---
        const Icon = ({ name, className = "" }) => (
            <span 
                style={{ display: 'contents' }}
                dangerouslySetInnerHTML={{ 
                    __html: `<i data-lucide="${name}" class="${className}"></i>` 
                }}
            />
        );
        
        // --- QuestionCard ç»„ä»¶ ---
        const QuestionCard = React.memo(({ question, index, mode, isCurrent, isDarkMode, favorites, toggleFavorite, showAnswer, setShowAnswer, totalQuestions }) => {
            const isRecitation = mode === 'recitation';
            // èƒŒé¢˜ä¸‹ç­”æ¡ˆå§‹ç»ˆæ˜¾ç¤º
            const displayAnswer = isRecitation || showAnswer;
            
            // è®¡ç®—è¿›åº¦æ¡ç™¾åˆ†æ¯”
            const progressPercent = totalQuestions > 0 ? ((index + 1) / totalQuestions) * 100 : 0;

            // ä»…åœ¨åˆ·é¢˜ä¸‹ï¼Œç‚¹å‡»é—®é¢˜åˆ‡æ¢ç­”æ¡ˆ
            const handleCardClick = () => {
                if (isCurrent && !isRecitation) {
                    setShowAnswer(prev => !prev);
                }
            };

            const CardBody = (
                <div className="flex-1 p-8 pt-20 flex flex-col items-center justify-center text-center relative max-w-2xl mx-auto w-full">
                    
                    {/* 1. é—®é¢˜ */}
                    <div 
                        onClick={handleCardClick}
                        className={`w-full cursor-pointer transition-all duration-300 ${displayAnswer ? 'mb-8 opacity-100' : 'mb-0 opacity-100'}`}
                    >
                        <h3 className={`text-3xl md:text-4xl font-bold leading-snug tracking-tight ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>
                            {question.question}
                        </h3>
                        {!displayAnswer && !isRecitation && (
                            <div className={`mt-12 flex flex-col items-center gap-2 transition-opacity duration-300 ${isDarkMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                <Icon name="mouse-pointer" className="w-8 h-8 animate-pulse" />
                                <span className="text-sm font-medium">ç‚¹å‡»é—®é¢˜æŸ¥çœ‹ç­”æ¡ˆ</span>
                            </div>
                        )}
                    </div>
                    
                    {/* 2. ç­”æ¡ˆåŒºåŸŸ */}
                    {displayAnswer && (
                        <div className="w-full text-left mt-8 animate-fade-in-up">
                            <div className={`relative p-6 rounded-2xl ${isDarkMode ? 'bg-green-900/20 border border-green-900/30' : 'bg-green-50/80 border border-green-100'}`}>
                                <div className="flex gap-4">
                                    <div className={`mt-1 shrink-0 ${isDarkMode ? 'text-green-400' : 'text-green-600'}`}>
                                        <Icon name="check-circle" className="w-6 h-6" />
                                    </div>
                                    <div className={`text-lg leading-relaxed whitespace-pre-wrap ${isDarkMode ? 'text-gray-200' : 'text-gray-700'}`}>
                                        {question.answer}
                                    </div>
                                </div>
                            </div>
                            {/* ä»…åœ¨åˆ·é¢˜ä¸‹æ˜¾ç¤ºæç¤º */}
                            {!isRecitation && (
                                <div className={`mt-4 text-center text-xs ${isDarkMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                    å†æ¬¡ç‚¹å‡»é—®é¢˜éšè—ç­”æ¡ˆ
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );


            return (
                <div className="snap-item w-full">
                    <div className="max-w-4xl mx-auto w-full h-full flex flex-col">
                        
                        {CardBody}

                        {/* è¿›åº¦æ¡ (åº•éƒ¨å›ºå®š) */}
                        <div className="absolute bottom-0 left-0 right-0 p-4 pt-10">
                            <div className="flex items-center gap-4 max-w-lg mx-auto mb-4">
                                <span className={`text-xs font-variant-numeric tabular-nums w-8 text-right ${isDarkMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                    {index + 1}
                                </span>
                                <div className={`flex-1 h-2 rounded-full overflow-hidden ${isDarkMode ? 'bg-gray-800' : 'bg-gray-200'}`}>
                                    <div 
                                        className="h-full bg-blue-500 rounded-full transition-all duration-500 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)]" 
                                        style={{ width: `${progressPercent}%` }}
                                    ></div>
                                </div>
                                <span className={`text-xs font-variant-numeric tabular-nums w-8 ${isDarkMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                    {/* å ä½ç¬¦ï¼Œå®é™…æ€»æ•°åœ¨ Header æ˜¾ç¤º */}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        });


        const App = () => {
            // --- çŠ¶æ€å®šä¹‰ ---
            const [questions, setQuestions] = useState([]);
            const [fileName, setFileName] = useState("");
            
            // UI çŠ¶æ€
            const [mode, setMode] = useState('quiz'); // 'quiz' (åˆ·é¢˜) | 'recitation' (èƒŒé¢˜)
            const [currentIndex, setCurrentIndex] = useState(0);
            const [showAnswer, setShowAnswer] = useState(false);
            const [isDarkMode, setIsDarkMode] = useState(false);
            const [isRandom, setIsRandom] = useState(false);
            const [filterCategory, setFilterCategory] = useState("all");
            
            // æ•°æ®æŒä¹…åŒ–çŠ¶æ€
            const [favorites, setFavorites] = useState(new Set()); 
            
            const scrollRef = useRef(null);
            
            // --- åˆå§‹åŒ–ä¸å‰¯ä½œç”¨ ---

            // 1. åˆå§‹åŒ– Lucide å›¾æ ‡
            useEffect(() => {
                lucide.createIcons();
            }, [showAnswer, currentIndex, isDarkMode, questions]);

            // 2. åŠ è½½æœ¬åœ°å­˜å‚¨çš„è®¾ç½®
            useEffect(() => {
                const savedSettings = localStorage.getItem('quiz_app_settings');
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    setIsDarkMode(settings.isDarkMode);
                    setMode(settings.mode || 'quiz'); // åŠ è½½æ¨¡å¼
                    if (settings.isDarkMode) document.documentElement.classList.add('dark');
                }
            }, []);

            // 3. ç›‘å¬æš—è‰²æ¨¡å¼å’Œæ¨¡å¼å˜åŒ–å¹¶ä¿å­˜
            useEffect(() => {
                if (isDarkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                localStorage.setItem('quiz_app_settings', JSON.stringify({ isDarkMode, mode }));
            }, [isDarkMode, mode]);


            // 4. å½“æ–‡ä»¶åå˜åŒ–ï¼ˆåŠ è½½æ–°æ–‡ä»¶ï¼‰æ—¶ï¼Œå°è¯•è¯»å–è¿›åº¦
            useEffect(() => {
                if (!fileName) return;
                const fileData = localStorage.getItem(`quiz_data_${fileName}`);
                if (fileData) {
                    try {
                        const data = JSON.parse(fileData);
                        if (data.lastIndex !== undefined && data.lastIndex < questions.length) {
                            setCurrentIndex(data.lastIndex);
                        } else {
                            setCurrentIndex(0);
                        }
                        if (data.favorites) {
                            setFavorites(new Set(data.favorites));
                        } else {
                            setFavorites(new Set());
                        }
                    } catch(e) {
                         console.error("Failed to load local storage data:", e);
                         setCurrentIndex(0);
                         setFavorites(new Set());
                    }
                } else {
                    setCurrentIndex(0);
                    setFavorites(new Set());
                }
                setFilterCategory("all"); 
            }, [fileName, questions.length]); 

            // 5. è‡ªåŠ¨ä¿å­˜è¿›åº¦å’Œæ”¶è—
            useEffect(() => {
                if (!fileName || questions.length === 0) return;
                const dataToSave = {
                    lastIndex: currentIndex,
                    favorites: Array.from(favorites)
                };
                localStorage.setItem(`quiz_data_${fileName}`, JSON.stringify(dataToSave));
            }, [currentIndex, favorites, fileName, questions.length]);
            
            // 6. åˆ‡æ¢é¢˜ç›®æ—¶æ¸…ç©ºç­”æ¡ˆçŠ¶æ€
            useEffect(() => {
                setShowAnswer(false);
            }, [currentIndex, filterCategory]);

            // --- æ•°æ®è¿‡æ»¤é€»è¾‘ ---
            const categories = useMemo(() => 
                ["all", "favorites", ...new Set(questions.map(q => q.category).filter(Boolean))], 
                [questions]
            );

            // ä¿®æ­£ï¼šç¡®ä¿ filteredQuestions å§‹ç»ˆæ˜¯ä¸€ä¸ªæ•°ç»„
            const baseFilteredQuestions = useMemo(() => {
                let list = questions || []; // ç¡®ä¿ä» questions çŠ¶æ€å¼€å§‹å°±æ˜¯æ•°ç»„
                
                if (filterCategory === "favorites") {
                    list = list.filter(q => favorites.has(q.question));
                } else if (filterCategory !== "all") {
                    list = list.filter(q => q.category === filterCategory);
                }
                return list;
            }, [questions, filterCategory, favorites]);
            
            // éšæœºæ¨¡å¼çš„å¤„ç†éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œä½†æˆ‘ä»¬ä¸»è¦å…³æ³¨è§£å†³ length é”™è¯¯
            const filteredQuestions = useMemo(() => {
                // å¦‚æœæ˜¯éšæœºæ¨¡å¼ï¼Œæˆ‘ä»¬åªåœ¨åˆ—è¡¨ä¸­ä¿ç•™å½“å‰çš„é—®é¢˜ï¼Œä½†ä¾èµ– baseFilteredQuestions çš„é•¿åº¦æ¥åšç´¢å¼•è¾¹ç•Œæ£€æŸ¥
                if (isRandom && baseFilteredQuestions.length > 0) {
                    // å¦‚æœå½“å‰ç´¢å¼•è¶…å‡ºèŒƒå›´ï¼ˆä¾‹å¦‚ï¼Œä»æ”¶è—å¤¹åˆ‡æ¢åˆ°å…¨éƒ¨ï¼ŒbaseFilteredQuestionså˜å¤§ï¼‰ï¼Œå®ƒä¼šä½¿ç”¨ baseFilteredQuestions[currentIndex]
                    const question = baseFilteredQuestions[currentIndex] || baseFilteredQuestions[0];
                    return [question].filter(Boolean);
                }
                
                return baseFilteredQuestions;

            }, [isRandom, baseFilteredQuestions, currentIndex]);
            
            // 7. æ»šåŠ¨åˆ°å½“å‰ç´¢å¼•ä½ç½® (æ¨¡æ‹Ÿé¡µé¢åˆ‡æ¢)
            useEffect(() => {
                if (scrollRef.current && currentIndex >= 0) {
                    const listToScroll = isRandom ? baseFilteredQuestions : filteredQuestions;
                    const indexInFullList = isRandom 
                        ? baseFilteredQuestions.findIndex(q => q.question === filteredQuestions[0]?.question) 
                        : currentIndex;
                    
                    if (indexInFullList < 0) return; // æ‰¾ä¸åˆ°é¢˜ç›®ï¼Œé€€å‡º

                    // ä½¿ç”¨ setTimeout ç¡®ä¿ DOM æ¸²æŸ“å®Œæˆ
                    const timer = setTimeout(() => {
                        scrollRef.current.scrollTo({
                            top: indexInFullList * scrollRef.current.clientHeight,
                            behavior: 'smooth'
                        });
                    }, 50);
                    return () => clearTimeout(timer);
                }
            }, [currentIndex, isRandom, filteredQuestions.length]); 

            // 8. ç›‘å¬æ»šåŠ¨äº‹ä»¶æ›´æ–° currentIndex
            const handleScroll = () => {
                const list = filteredQuestions; 
                // ä¿®æ­£ï¼šç¡®ä¿ list å­˜åœ¨ä¸”éç©º
                if (!scrollRef.current || !list || list.length === 0) return;

                if (scrollRef.current.scrollTimeout) {
                    clearTimeout(scrollRef.current.scrollTimeout);
                }

                scrollRef.current.scrollTimeout = setTimeout(() => {
                    const scrollPosition = scrollRef.current.scrollTop;
                    const itemHeight = scrollRef.current.clientHeight;
                    
                    if(itemHeight === 0) return; // é¿å…é™¤ä»¥é›¶
                    
                    const newIndex = Math.round(scrollPosition / itemHeight);
                    
                    if (newIndex !== currentIndex) {
                        const safeIndex = Math.min(Math.max(0, newIndex), list.length - 1); 
                        setCurrentIndex(safeIndex);
                    }
                }, 100); 
            };
            
            // 9. ç¡®ä¿ç´¢å¼•æœ‰æ•ˆ
            useEffect(() => {
                if (currentIndex >= filteredQuestions.length && filteredQuestions.length > 0) {
                    setCurrentIndex(0);
                } else if (filteredQuestions.length === 0) {
                    setCurrentIndex(-1);
                }
            }, [filteredQuestions.length]);


            // --- æ¸²æŸ“è¾…åŠ©å˜é‡ ---
            const currentQuestion = filteredQuestions[currentIndex];
            const isCurrentFavorite = currentQuestion && favorites.has(currentQuestion.question);
            const totalQuestions = filteredQuestions.length;


            // --- è¾…åŠ©å‡½æ•° ---
            const toggleFavorite = (e) => {
                e.stopPropagation(); 
                const currentQ = filteredQuestions[currentIndex];
                if (!currentQ) return;
                
                const key = currentQ.question;
                
                const newFavs = new Set(favorites);
                if (newFavs.has(key)) {
                    newFavs.delete(key);
                } else {
                    newFavs.add(key);
                }
                setFavorites(newFavs);
            };

            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                event.target.value = null; 
                setFileName(file.name);
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    const content = e.target.result;
                    try {
                        let data;
                        if (file.name.endsWith('.yaml') || file.name.endsWith('.yml')) {
                            data = jsyaml.load(content);
                        } else {
                            data = JSON.parse(content);
                        }
                        
                        let qs = [];
                        if (Array.isArray(data)) {
                            qs = data;
                        } else if (data.questions) {
                            qs = data.questions;
                        } else {
                            alert("æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œæ‰¾ä¸åˆ° questions æ•°ç»„");
                            return;
                        }
                        setQuestions(qs);
                        setShowAnswer(false);
                    } catch (error) {
                        alert("è§£ææ–‡ä»¶å¤±è´¥: " + error.message);
                    }
                };
                reader.readAsText(file);
            };


            // 1. ç©ºçŠ¶æ€ / æ¬¢è¿é¡µ
            if (questions.length === 0) {
                return (
                    <div className={`min-h-screen flex items-center justify-center p-6 transition-colors duration-500 ${isDarkMode ? 'bg-black text-white' : 'bg-[#F2F2F7] text-gray-800'}`}>
                        <div className={`max-w-md w-full text-center p-10 rounded-3xl shadow-2xl transition-all duration-300 ${isDarkMode ? 'bg-[#1C1C1E] border border-gray-800' : 'bg-white'}`}>
                            <div className="flex justify-center mb-6">
                                <div className="p-4 bg-gradient-to-tr from-blue-500 to-cyan-400 rounded-2xl shadow-glow">
                                    <Icon name="book-open" className="w-10 h-10 text-white" />
                                </div>
                            </div>
                            <h1 className="text-3xl font-bold mb-4 tracking-tight">å¼€å§‹å¤ä¹ </h1>
                            <p className={`mb-8 ${isDarkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                                ä¸Šä¼ ä½ çš„é…ç½®æ–‡ä»¶ (JSON/YAML) <br/> ä½“éªŒå…¨æ–°çš„åˆ·é¢˜æ–¹å¼
                            </p>
                            
                            <label className="group cursor-pointer relative inline-flex items-center justify-center px-8 py-4 font-semibold text-white transition-all duration-200 bg-blue-600 rounded-full hover:bg-blue-700 active:scale-95 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-600 shadow-lg shadow-blue-500/30 overflow-hidden">
                                <span className="relative flex items-center gap-2">
                                    <Icon name="upload-cloud" className="w-5 h-5" />
                                    é€‰æ‹©æ–‡ä»¶
                                </span>
                                <input type="file" accept=".json,.yaml,.yml" onChange={handleFileUpload} className="hidden" />
                            </label>

                            <div className="mt-8 flex justify-center gap-4">
                                <button 
                                    onClick={() => setIsDarkMode(!isDarkMode)}
                                    className={`p-3 rounded-full transition-colors ${isDarkMode ? 'bg-gray-800 text-yellow-400 hover:bg-gray-700' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}`}
                                >
                                    <Icon name={isDarkMode ? "sun" : "moon"} className="w-5 h-5" />
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // 2. ç­›é€‰ç»“æœä¸ºç©º
            if (totalQuestions === 0) {
                 return (
                    <div className={`min-h-screen flex flex-col items-center justify-center p-4 transition-colors ${isDarkMode ? 'bg-black text-white' : 'bg-[#F2F2F7] text-gray-800'}`}>
                        <div className="text-center">
                            <Icon name="inbox" className={`w-16 h-16 mx-auto mb-4 ${isDarkMode ? 'text-gray-700' : 'text-gray-300'}`} />
                            <p className="text-lg font-medium mb-2">æ²¡æœ‰æ‰¾åˆ°é¢˜ç›®</p>
                            <p className={`text-sm mb-6 ${isDarkMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                {filterCategory === "favorites" ? "ä½ è¿˜æ²¡æœ‰æ”¶è—ä»»ä½•é¢˜ç›®" : "è¯¥åˆ†ç±»ä¸‹æš‚æ—¶æ²¡æœ‰å†…å®¹"}
                            </p>
                            <button 
                                onClick={() => setFilterCategory("all")} 
                                className="px-6 py-2.5 bg-blue-600 text-white rounded-full font-medium shadow-lg shadow-blue-500/30 hover:bg-blue-700 active:scale-95 transition-all"
                            >
                                è¿”å›å…¨éƒ¨
                            </button>
                        </div>
                    </div>
                 )
            }

            // 3. ä¸»ç•Œé¢
            return (
                <div className={`h-screen transition-colors duration-300 ${isDarkMode ? 'bg-black text-white' : 'bg-[#F2F2F7] text-gray-900'}`}>
                    
                    {/* æ»šåŠ¨å¡ç‰‡åˆ—è¡¨ */}
                    <div 
                        ref={scrollRef} 
                        className="snap-scroll-y no-scrollbar"
                        onScroll={handleScroll}
                    >
                        {filteredQuestions.map((q, index) => (
                            <QuestionCard 
                                key={q.question} 
                                question={q} 
                                index={index} 
                                mode={mode}
                                isCurrent={index === currentIndex}
                                isDarkMode={isDarkMode}
                                favorites={favorites}
                                toggleFavorite={toggleFavorite}
                                showAnswer={index === currentIndex ? showAnswer : false}
                                setShowAnswer={setShowAnswer}
                                totalQuestions={totalQuestions} 
                            />
                        ))}
                    </div>

                    {/* é¡¶éƒ¨æ§åˆ¶æ  (Header) */}
                    <header className={`fixed top-0 left-0 right-0 z-50 px-4 py-3 backdrop-blur-md border-b transition-colors duration-300 ${isDarkMode ? 'bg-black/70 border-gray-800' : 'bg-white/70 border-gray-200'}`}>
                        <div className="max-w-3xl mx-auto flex justify-between items-center h-10">
                            
                            {/* æ–‡ä»¶ä¿¡æ¯å’Œæ¨¡å¼åˆ‡æ¢ */}
                            <div className="flex items-center gap-3">
                                {/* æ¨¡å¼åˆ‡æ¢ */}
                                <div className={`flex p-1 rounded-full text-sm font-medium transition-colors ${isDarkMode ? 'bg-gray-800' : 'bg-gray-100'}`}>
                                    <button 
                                        onClick={() => setMode('quiz')}
                                        className={`px-3 py-1 rounded-full transition-colors active:scale-95 ${mode === 'quiz' ? 'bg-blue-500 text-white shadow-md' : 'text-gray-500 hover:text-gray-700'}`}
                                    >
                                        åˆ·é¢˜
                                    </button>
                                    <button 
                                        onClick={() => setMode('recitation')}
                                        className={`px-3 py-1 rounded-full transition-colors active:scale-95 ${mode === 'recitation' ? 'bg-blue-500 text-white shadow-md' : 'text-gray-500 hover:text-gray-700'}`}
                                    >
                                        èƒŒé¢˜
                                    </button>
                                </div>
                            </div>
                            
                            {/* ç­›é€‰å’Œè®¾ç½® */}
                            <div className="flex items-center gap-2">
                                {/* åˆ†ç±»ç­›é€‰ */}
                                <div className="relative group">
                                    <select 
                                        value={filterCategory}
                                        onChange={(e) => {
                                            setFilterCategory(e.target.value);
                                            setCurrentIndex(0); 
                                            setShowAnswer(false);
                                        }}
                                        className={`appearance-none pl-3 pr-8 py-1 rounded-full text-xs font-medium border transition-all cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500 ${isDarkMode ? 'bg-gray-900 border-gray-700 text-white' : 'bg-white border-gray-200 text-gray-700 hover:border-gray-300'}`}
                                    >
                                        <option value="all">ğŸ“š å…¨éƒ¨</option>
                                        <option value="favorites">â­ï¸ æ”¶è— ({favorites.size})</option>
                                        {categories.filter(c => c !== "all" && c !== "favorites").map(c => (
                                            <option key={c} value={c}>{c.split('ã€')[1] || c}</option>
                                        ))}
                                    </select>
                                    <div className="absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none">
                                        <Icon name="chevron-down" className={`w-3 h-3 ${isDarkMode ? 'text-gray-500' : 'text-gray-400'}`} />
                                    </div>
                                </div>
                                
                                {/* éšæœºæ¨¡å¼ */}
                                <button 
                                    onClick={() => setIsRandom(!isRandom)}
                                    className={`p-2 rounded-full transition-all active:scale-90 ${isRandom 
                                        ? 'text-blue-500 bg-blue-500/10'
                                        : isDarkMode ? 'text-gray-400 hover:bg-gray-800' : 'text-gray-600 hover:bg-gray-200'
                                    }`}
                                    title={isRandom ? "å½“å‰ä¸ºéšæœºæ¨¡å¼" : "åˆ‡æ¢åˆ°éšæœºæ¨¡å¼"}
                                >
                                    <Icon name="shuffle" className="w-5 h-5" />
                                </button>
                                
                                {/* æš—è‰²æ¨¡å¼åˆ‡æ¢ */}
                                <button 
                                    onClick={() => setIsDarkMode(!isDarkMode)}
                                    className={`p-2 rounded-full transition-all active:scale-90 ${isDarkMode ? 'text-yellow-400 hover:bg-gray-800' : 'text-gray-600 hover:bg-gray-200'}`}
                                    title="åˆ‡æ¢ä¸»é¢˜"
                                >
                                    <Icon name={isDarkMode ? "sun" : "moon"} className="w-5 h-5" />
                                </button>
                            </div>
                        </div>
                    </header>
                    
                    {/* å³ä¾§æ“ä½œæ  (TikTok é£æ ¼) */}
                    {totalQuestions > 0 && currentQuestion && (
                        <div className="fixed right-0 top-1/2 transform -translate-y-1/2 mr-4 z-40 flex flex-col gap-4">
                            
                            {/* æ”¶è—æŒ‰é’® */}
                            <button 
                                onClick={toggleFavorite}
                                className={`flex flex-col items-center justify-center p-3 rounded-full transition-all active:scale-90 shadow-md ${isCurrentFavorite ? 'text-yellow-400 bg-yellow-400/10' : isDarkMode ? 'text-white bg-gray-800/80 hover:bg-gray-800' : 'text-gray-700 bg-white/80 hover:bg-white'}`}
                                title={isCurrentFavorite ? "å–æ¶ˆæ”¶è—" : "æ”¶è—é¢˜ç›®"}
                            >
                                <Icon name="star" className={`w-7 h-7 ${isCurrentFavorite ? 'fill-current' : ''}`} />
                                <span className="text-xs mt-1">{isCurrentFavorite ? 'å·²æ”¶è—' : 'æ”¶è—'}</span>
                            </button>

                             {/* è¿›åº¦æ˜¾ç¤º */}
                            <div className={`flex flex-col items-center text-xs mt-2 ${isDarkMode ? 'text-gray-500' : 'text-gray-600'}`}>
                                <span>{currentIndex + 1}</span>
                                <span>/</span>
                                <span>{totalQuestions}</span>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
